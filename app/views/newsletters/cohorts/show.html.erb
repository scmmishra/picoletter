<section class="flex items-center justify-between gap-2 mb-6">
  <div class="flex items-center gap-3">
    <%= cohort_icon(icon: @cohort.icon, color: @cohort.color, size: 'lg') %>
    <h2 class="text-xl font-medium"><%= @cohort.name %></h2>
  </div>
  <div class="flex items-center gap-2">
    <%= link_to edit_cohort_path(@newsletter.slug, @cohort), class: 'btn btn-secondary flex items-center' do %>
      <%= lucide_icon("edit", class: "size-4 mr-1") %>
      Edit
    <% end %>
    <%= link_to cohorts_path(@newsletter.slug), class: 'btn btn-secondary flex items-center' do %>
      <%= lucide_icon("arrow-left", class: "size-4 mr-1") %>
      Back to Cohorts
    <% end %>
  </div>
</section>

<div class="flex flex-col lg:flex-row gap-8">
  <!-- Left Column: Cohort Details -->
  <div class="max-w-xl flex-shrink-0 space-y-6 w-full">
    <div class="bg-stone-50 rounded-lg p-4">
      <div class="grid grid-cols-2 gap-4">
        <div class="text-center">
          <div class="text-2xl font-semibold text-stone-900"><%= @cohort.subscriber_count %></div>
          <div class="text-sm text-stone-600">Subscribers</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-semibold text-stone-900"><%= @cohort.posts.count %></div>
          <div class="text-sm text-stone-600">Posts Sent</div>
        </div>
      </div>
    </div>

    <% if @cohort.description %>
      <div>
        <h3 class="font-medium text-stone-900 mb-2">Description</h3>
        <p class="text-stone-600"><%= @cohort.description %></p>
      </div>
    <% end %>

    <div>
      <h3 class="font-medium text-stone-900 mb-3">Filter Conditions</h3>
      <%= render 'filter_display', cohort: @cohort, newsletter: @newsletter %>
    </div>

    <% if @cohort.posts.any? %>
      <div>
        <h3 class="font-medium text-stone-900 mb-3">Posts Sent to This Cohort</h3>
        <div class="space-y-2">
          <% @cohort.posts.order(published_at: :desc).limit(5).each do |post| %>
            <div class="flex items-center justify-between p-3 bg-white border border-stone-200 rounded-lg">
              <div>
                <h4 class="font-medium text-stone-900"><%= post.title %></h4>
                <p class="text-sm text-stone-500">
                  Published on <%= post.published_at.strftime("%B %e, %Y") %>
                </p>
              </div>
              <%= link_to post_path(@newsletter.slug, post), class: "text-stone-400 hover:text-stone-600" do %>
                <%= lucide_icon("arrow-right", class: "size-4") %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Right Column: Subscribers List -->
  <div class="flex-grow space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="font-medium text-stone-900">Subscribers in this Cohort</h3>
    </div>

    <div class="bg-white border border-stone-200 rounded-lg overflow-hidden">
      <% if @cohort_subscribers.empty? %>
        <div class="py-20">
          <p class="text-center text-stone-500">No subscribers match this cohort's conditions yet.</p>
        </div>
      <% else %>
        <section class="divide-y divide-stone-200">
          <div class="grid grid-cols-12 py-4 px-6 font-sans text-xs font-medium tracking-widest uppercase text-stone-500 bg-stone-50">
            <div class="col-span-3">Name</div>
            <div class="col-span-4">Email</div>
            <div class="col-span-5">Labels</div>
          </div>

          <% @cohort_subscribers.each do |subscriber| %>
            <%= link_to subscriber_path(@newsletter.slug, subscriber.id) do %>
              <div class="grid grid-cols-12 py-4 px-6 hover:bg-gradient-to-r from-slate-50/10 via-stone-50 to-slate-50/10">
                <div class="col-span-3 font-medium text-stone-800">
                  <h2><%= subscriber.full_name.present? ? subscriber.full_name : "-" %></h2>
                </div>
                <div class="col-span-4 font-sans text-sm text-stone-500">
                  <h2><%= subscriber.email %></h2>
                </div>
                <div class="col-span-5">
                  <% if subscriber.labels.any? %>
                    <div class="h-8 flex items-center">
                      <div class="flex gap-1 overflow-x-auto scrollbar-hide">
                        <% subscriber.labels.each do |label_name| %>
                          <% label = @newsletter.labels.find_by(name: label_name) %>
                          <% if label %>
                            <div class="flex-shrink-0">
                              <%= render "shared/label_tag", label: label %>
                            </div>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  <% else %>
                    <div class="h-8 flex items-center">
                      <span class="text-sm text-stone-400">No labels</span>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </section>

        <div class="flex items-center justify-between px-6 py-3 bg-stone-50 border-t border-stone-200 font-sans">
          <span class="text-sm text-stone-600">
            <%= @cohort.subscriber_count %> total subscribers
          </span>
          <%== pagy_nav @pagy, id: "pagy-nav", aria_label: "Pagination" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
