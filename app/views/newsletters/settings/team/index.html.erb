<%= render "newsletters/settings/partials/header" %>

<main class="space-y-8 max-w-lg">
  <!-- Invite Team Member Section -->
  <% if @newsletter.can_write?(:team) %>
    <section>
      <h2 class="text-xl font-semibold text-stone-800 mb-4">Invite Team Member</h2>
      <div class="shadow-with-inset bg-stone-50 font-sans p-5 rounded-lg">
        <%= labeled_form_with scope: :invitation, url: settings_team_invite_path(slug: @newsletter.slug), method: :post, local: true do |form| %>
          <div class="flex gap-3 items-end">
            <div class="flex-1">
              <%= form.email_field :email,
                              label: "Email address",
                              required: true,
                              placeholder: "team@example.com" %>
            </div>

            <div class="w-40">
              <%= form.select :role,
                          options_for_select([['Editor', 'editor'], ['Administrator', 'administrator']], 'editor'),
                          {},
                          label: "Role",
                          hint: "Editors can manage content, Administrators have full access" %>
            </div>

          </div>
          <div>
            <%= form.submit "Send Invitation", class: "btn w-full mt-4 btn-primary text-sm" %>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Team Members Section -->
  <section>
    <h2 class="text-xl font-semibold text-stone-800 mb-4">Team Members</h2>
    <div class="overflow-hidden border border-stone-200 rounded-lg">
      <table class="min-w-full divide-y divide-stone-200">
        <thead class="bg-stone-50 font-sans text-xs font-normal text-stone-500 uppercase tracking-wider">
          <tr>
            <th scope="col" class="px-4 py-3 text-left">Member</th>
            <th scope="col" class="px-4 py-3 text-left">Role</th>
            <th scope="col" class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-stone-200">
          <!-- Members -->
          <% @memberships.each do |membership| %>
            <tr>
              <td class="px-4 py-3 whitespace-nowrap">
                <div>
                  <p class="text-sm font-medium text-stone-700"><%= membership.user.name %></p>
                  <p class="text-sm font-sans text-stone-500"><%= membership.user.email %></p>
                </div>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <span class="px-2 py-1 text-[10px] font-medium uppercase tracking-widest font-sans text-stone-600 bg-stone-100 rounded">
                  <%= membership.role %>
                </span>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-right">
                <% if @newsletter.can_write?(:team) %>
                  <%= button_to settings_team_member_path(slug: @newsletter.slug, id: membership.id),
                              method: :delete,
                              data: { confirm: "Are you sure you want to remove this team member?" },
                              class: "btn btn-danger" do %>
                      <%= lucide_icon("trash-2", class: "size-3 text-white") %>
                  <% end %>
                <% else %>
                  <span class="text-sm text-stone-500">—</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Pending Invitations Section -->
  <% if @invitations.any? %>
    <section>
      <h2 class="text-xl font-semibold text-stone-800 mb-4">Pending Invitations</h2>
      <div class="overflow-hidden border border-stone-200 rounded-lg">
        <table class="min-w-full divide-y divide-stone-200">
          <thead class="bg-stone-50 font-sans text-xs font-normal text-stone-500 uppercase tracking-wider">
            <tr>
              <th scope="col" class="px-4 py-3 text-left">Email</th>
              <th scope="col" class="px-4 py-3 text-left">Role</th>
              <th scope="col" class="px-4 py-3 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-stone-200">
            <% @invitations.each do |invitation| %>
              <tr>
                <td class="px-4 py-3 whitespace-nowrap">
                  <p class="text-sm font-medium text-stone-700"><%= invitation.email %></p>
                  <p class="text-sm font-sans text-stone-500">Invited on <%= invitation.created_at.strftime("%b %d, %Y") %></p>
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <span class="px-2 py-1 font-sans uppercase tracking-wider text-[10px] font-medium text-amber-600 bg-amber-100 rounded">
                    <%= invitation.role %>
                  </span>
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-right">
                  <% if @newsletter.can_write?(:team) %>
                    <%= button_to settings_team_invitation_path(slug: @newsletter.slug, id: invitation.id),
                                method: :delete,
                                data: { confirm: "Are you sure you want to cancel this invitation?" },
                                class: "btn btn-danger" do %>
                                  <%= lucide_icon("trash-2", class: "size-3 text-white") %>
                    <% end %>
                  <% else %>
                    <span class="text-sm text-stone-500">—</span>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>
  <% end %>
</main>
