<%= render "newsletters/settings/partials/header" %>

<div class="space-y-8">
  <% if @newsletter.ses_verified? %>
    <%= render "newsletters/settings/partials/settings_section", title: "Sending Domain", subtitle: "Your custom sending domain is configured and verified." do %>
      <div class="max-w-lg">
        <div class="rounded-lg border border-stone-200 bg-white divide-y divide-stone-100">
          <div class="px-4 py-3">
            <p class="text-xs font-sans text-stone-400 uppercase tracking-wider">Sending From</p>
            <p class="text-sm text-stone-800 mt-1"><%= @newsletter.sending_name || @newsletter.title %></p>
          </div>
          <div class="px-4 py-3">
            <p class="text-xs font-sans text-stone-400 uppercase tracking-wider">Sending Address</p>
            <p class="text-sm text-stone-800 mt-1"><%= @newsletter.sending_address %></p>
          </div>
          <% if @newsletter.reply_to.present? %>
            <div class="px-4 py-3">
              <p class="text-xs font-sans text-stone-400 uppercase tracking-wider">Reply To</p>
              <p class="text-sm text-stone-800 mt-1"><%= @newsletter.reply_to %></p>
            </div>
          <% end %>
        </div>

        <div class="mt-4">
          <%= button_to settings_sending_disconnect_domain_path(slug: @newsletter.slug),
              method: :delete,
              class: "btn btn-sm btn-outline text-red-600 hover:bg-red-50 hover:text-red-700 border-red-200 hover:border-red-300",
              form: { data: { turbo_confirm: "Are you sure you want to disconnect this domain? Your newsletter will revert to using the default picoletter.com sending address." } } do %>
            Disconnect Domain
          <% end %>
        </div>
      </div>
    <% end %>

    <%= render "newsletters/settings/partials/settings_section", title: "DNS Records", subtitle: "Your domain has been verified successfully. The following are the DNS records you have added." do %>
      <%= render "newsletters/settings/partials/dns_records", newsletter: @newsletter %>
    <% end %>
  <% else %>
    <%= render "newsletters/settings/partials/settings_section", title: "Sending Domain", subtitle: "Configure your custom sending domain to improve deliverability. You can also use the default domain mail.picoletter.com." do %>
      <%= labeled_form_with model: @newsletter, url: settings_sending_path(slug: @newsletter.slug), method: :patch, permission: :sending do |form| %>
        <div class="max-w-lg space-y-4">
          <%= form.text_field :sending_name,
                          placeholder: "Shivam from Picoletter",
                          label: "Sending From" %>

          <%= form.text_field :sending_address,
                          placeholder: "updates@picoletter.com",
                          label: "Sending Address" %>

          <%= form.text_field :reply_to,
                          placeholder: "hey@picoletter.com",
                          label: "Reply To" %>
        </div>
        <div class="mt-5"><%= form.submit "Update Settings", class: "btn btn-primary" %></div>
      <% end %>
    <% end %>

    <% if @newsletter.sending_domain.present? %>
      <%= render "newsletters/settings/partials/settings_section", title: "Domain Verification", subtitle: "Add the following DNS records to your DNS settings, to verify your domain. Verification ensures your emails are delivered properly and does not end up in spam. Please note that it can take a couple of hours for the DNS records to start reflecting." do %>
        <%= labeled_form_with model: @newsletter, url: settings_sending_verify_domain_path(slug: @newsletter.slug), method: :post do |form| %>
          <%= render "newsletters/settings/partials/dns_records", newsletter: @newsletter %>
          <p class="mt-1 ml-1 font-sans text-xs text-stone-400">
            In case you're facing any trouble, you can drop us an email, and we will help you set it up.
          </p>

          <div class="mt-4"><%= form.submit "Verify DNS Records", class: "btn btn-secondary" %></div>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
</div>
