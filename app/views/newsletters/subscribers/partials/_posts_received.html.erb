<% post_emails = @subscriber.emails.where(emailable_type: "Post").includes(:emailable).order(created_at: :desc) %>

<% if post_emails.any? %>
  <div class="flex gap-2 font-sans text-stone-500 items-center mb-4 mt-8 text-sm">
    <h3>Posts Received</h3>
    <hr class="flex-grow">
  </div>

  <div class="rounded-md border border-stone-200 overflow-hidden">
    <table class="w-full text-sm font-sans">
      <thead class="bg-stone-50 text-stone-500 text-left">
        <tr>
          <th class="px-3 py-2 font-medium">Post</th>
          <th class="px-3 py-2 font-medium">Sent</th>
          <th class="px-3 py-2 font-medium">Status</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-stone-200">
        <% post_emails.each do |email| %>
          <% post = email.emailable %>
          <tr>
            <td class="px-3 py-2 text-stone-800">
              <% if post %>
                <%= link_to post.title, post_path(slug: @newsletter.slug, id: post.id), class: "hover:underline" %>
              <% else %>
                <span class="text-stone-400">Deleted post</span>
              <% end %>
            </td>

            <td class="px-3 py-2 text-stone-600">
              <% datetime = newsletter_datetime(email.created_at, @newsletter) %>
              <%= datetime[:date] %>
            </td>

            <td class="px-3 py-2">
              <% if email.opened_at.present? %>
                <span class="inline-flex items-center justify-center h-5 text-[10px] font-medium px-2 uppercase tracking-widest rounded-md bg-blue-100 text-blue-600">
                  opened
                </span>
              <% else %>
                <span
                  class="
                    inline-flex items-center justify-center h-5 text-[10px] font-medium px-2
                    uppercase tracking-widest rounded-md
                    <% case email.status %>
                    <% when 'delivered' %>
                      bg-green-100 text-green-600
                    <% when 'bounced' %>
                      bg-red-100 text-red-600
                    <% when 'complained' %>
                      bg-orange-100 text-orange-600
                    <% else %>
                      bg-stone-200 text-stone-600
                    <% end %>
                  "
                >
                  <%= email.status %>
                </span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>
